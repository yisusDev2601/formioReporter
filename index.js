// Ejemplo de uso
document.addEventListener('DOMContentLoaded', (e) => {
  const initialData = {"components":[{"label":"HTML","tag":"div","className":"container mb-3 p-2 text-center","attrs":[{"attr":"","value":""}],"content":"<div class=\"text-center\">\n  <h3>\n    <i class=\"fa-solid fa-water\"></i>\n  </h3>\n  <p>Texto del contenido</p>\n</div>","refreshOnChange":false,"key":"html","type":"htmlelement","input":false,"tableView":false},{"customClass":"card shadow p-3","key":"fieldSet1","type":"fieldset","label":"Field Set","input":false,"tableView":false,"components":[{"label":"Nombre del Reporte ","applyMaskOn":"change","tableView":true,"validate":{"required":true},"key":"name","type":"textfield","validateWhenHidden":false,"input":true},{"label":"Tipo de Reporte ","widget":"choicesjs","tableView":true,"data":{"values":[{"label":"Nivel de cauadal ","value":"1"},{"label":"Desborde de ríos y canales ","value":"2"}]},"validate":{"required":true},"key":"type","type":"select","validateWhenHidden":false,"input":true},{"label":"Afectación a: ","widget":"choicesjs","tableView":true,"multiple":true,"data":{"values":[{"label":"Ninguna","value":"0"},{"label":"Pérdida de servicios públicos (LUZ)","value":"1"},{"label":"Pérdida de servicios públicos (DRENAJE)","value":"2"},{"label":"Pérdida de servicios públicos (AGUA)","value":"3"},{"label":"Daños a infraestructura pública ","value":"4"},{"label":"Afectaciones en vivienda ","value":"5"},{"label":"Afectaciones a cultivos","value":"6"},{"label":"Otro daño patrimonial ","value":"7"}]},"validate":{"required":true},"key":"affect","type":"select","validateWhenHidden":false,"input":true}]},{"customClass":"card shadow p-3","key":"fieldSet2","type":"fieldset","label":"Field Set","input":false,"tableView":false,"components":[{"label":"Date / Time (Reporte)","tableView":false,"datePicker":{"disableWeekends":false,"disableWeekdays":false},"validate":{"required":true},"enableMinDateInput":false,"enableMaxDateInput":false,"key":"dateInit","type":"datetime","validateWhenHidden":false,"input":true,"widget":{"type":"calendar","displayInTimezone":"viewer","locale":"en","useLocaleSettings":false,"allowInput":true,"mode":"single","enableTime":true,"noCalendar":false,"format":"yyyy-MM-dd hh:mm a","hourIncrement":1,"minuteIncrement":1,"time_24hr":false,"minDate":null,"disableWeekends":false,"disableWeekdays":false,"maxDate":null}},{"label":"Se requiere coordinación con: ","widget":"choicesjs","description":"Elegir más de una opción si es necesario.","tableView":true,"multiple":true,"data":{"values":[{"label":"Protección Civil ","value":"1"},{"label":"Comisión Estatal de Agua y Alcantarillado","value":"2"},{"label":"Seguridad Pública","value":"3"},{"label":"Secretaría de Gobierno","value":"4"},{"label":"Comisión de Agua y Alcantarillado de Sistemas Intermunicipales","value":"5"},{"label":"Obras Públicas (SIPDUS)","value":"6"},{"label":"CONAGUA Hidalgo","value":"7"},{"label":"CFE","value":"8"},{"label":"CENAPRED","value":"9"}]},"validate":{"required":true},"validateWhenHidden":false,"key":"dependencia","type":"select","input":true},{"label":"Otra","description":"Indicar otra dependencia estatal o federal que no se encuentre en el listado. ","tableView":false,"validateWhenHidden":false,"key":"seRequiereCoordinacionCon","type":"tags","input":true}]},{"customClass":"card shadow p-3","key":"fieldSet3","type":"fieldset","label":"Field Set","input":false,"tableView":false,"components":[{"label":"Descripción del Reporte ","description":"Realizar descripción del reporte concon especificaciones. ","applyMaskOn":"change","autoExpand":false,"tableView":true,"validate":{"required":true},"validateWhenHidden":false,"key":"descripcionDelReporte","type":"textarea","input":true},{"label":"Ubicación del Reporte ","description":"Ingresa dirección empezando por calle, colonia o en su defecto localidadd.","tableView":false,"provider":"nominatim","validate":{"required":true},"validateWhenHidden":false,"key":"address","type":"address","providerOptions":{"params":{"autocompleteOptions":{}}},"input":true,"components":[{"label":"Address 1","tableView":false,"key":"address1","type":"textfield","input":true,"customConditional":"show = _.get(instance, 'parent.manualMode', false);"},{"label":"Address 2","tableView":false,"key":"address2","type":"textfield","input":true,"customConditional":"show = _.get(instance, 'parent.manualMode', false);"},{"label":"City","tableView":false,"key":"city","type":"textfield","input":true,"customConditional":"show = _.get(instance, 'parent.manualMode', false);"},{"label":"State","tableView":false,"key":"state","type":"textfield","input":true,"customConditional":"show = _.get(instance, 'parent.manualMode', false);"},{"label":"Country","tableView":false,"key":"country","type":"textfield","input":true,"customConditional":"show = _.get(instance, 'parent.manualMode', false);"},{"label":"Zip Code","tableView":false,"key":"zip","type":"textfield","input":true,"customConditional":"show = _.get(instance, 'parent.manualMode', false);"}]}]},{"customClass":"card shadow p-3","key":"fieldSet4","type":"fieldset","label":"Field Set","input":false,"tableView":false,"components":[{"label":"Nombre de quien reporta:","applyMaskOn":"change","tableView":true,"validate":{"required":true},"validateWhenHidden":false,"key":"nombreDeQuienReporta","type":"textfield","input":true},{"label":"Cargo / Adscripción.","applyMaskOn":"change","tableView":true,"validate":{"required":true},"validateWhenHidden":false,"key":"cargo","type":"textfield","input":true},{"label":"Número de Contacto:","applyMaskOn":"change","tableView":true,"validate":{"required":true},"validateWhenHidden":false,"key":"numeroDeContacto","type":"phoneNumber","input":true}]},{"type":"button","label":"Submit","key":"submit","disableOnInvalid":true,"input":true,"tableView":false}]}; // Tu data inicial
  const builderContainerId = 'builder'; // ID del contenedor del builder

  // Crear el contenedor para la tabla
  const tableConstructor = new FormioTableConstructor([], 'table-container');

  // Inicializar el Formio Builder y pasar la referencia del constructor de tabla
  const formioBuilder = new FormioBuilderCustom(initialData, builderContainerId, tableConstructor);

  // Simular datos iniciales
  tableConstructor.rows = [
    {"data":{"name":"Nombre de ejemplo","type":1,"affect":[1,4,7],"dateInit":"2024-09-18T12:00:00-06:00","dependencia":[6,4],"seRequiereCoordinacionCon":"Nuevo registro","descripcionDelReporte":"Se inundó por aca","address":{"place_id":303065215,"licence":"Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright","osm_type":"node","osm_id":459395507,"lat":"20.728889","lon":"-98.665556","class":"place","type":"hamlet","place_rank":20,"importance":0.25000999999999995,"addresstype":"hamlet","name":"Santa Mónica","display_name":"Santa Mónica, Tianguistengo, Hidalgo, México","address":{"hamlet":"Santa Mónica","county":"Tianguistengo","state":"Hidalgo","ISO3166-2-lvl4":"MX-HID","country":"México","country_code":"mx"},"boundingbox":["20.7088890","20.7488890","-98.6855560","-98.6455560"]},"nombreDeQuienReporta":"Jesús Ruiz López","cargo":"Subdirector","numeroDeContacto":"(771) 208-9872","submit":true},"metadata":{"timezone":"America/Mexico_City","offset":-360,"origin":"http://localhost:8000","referrer":"http://localhost:8000/link-informe/informe/1","browserName":"Netscape","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0","pathName":"/link-informe/1/block-item/tula/create","onLine":true,"selectData":{"type":{"label":"Nivel de cauadal "},"affect":{"1":{"label":"Pérdida de servicios públicos (LUZ)"},"4":{"label":"Daños a infraestructura pública "}},"dependencia":{"6":{"label":"Obras Públicas (SIPDUS)"}}}},"state":"submitted","_vnote":""},
    {"data":{"name":"Otro registro","submit":true},"metadata":{"timezone":"America/Mexico_City","offset":-360,"origin":"http://localhost:8000","referrer":"http://localhost:8000/link-informe/informe/1","browserName":"Netscape","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0","pathName":"/link-informe/1/block-item/tula/create","onLine":true},"state":"submitted","_vnote":""},
    {"data":{"name":"Otro registro","submit":true},"metadata":{"timezone":"America/Mexico_City","offset":-360,"origin":"http://localhost:8000","referrer":"http://localhost:8000/link-informe/informe/1","browserName":"Netscape","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0","pathName":"/link-informe/1/block-item/tula/create","onLine":true},"state":"submitted","_vnote":""}
  ];

  tableConstructor.buttonGenerate.addEventListener('click', function(e){
    const tableRenderer =  new TableRenderer('table-main');
    tableRenderer.renderTable(tableConstructor.headers,tableConstructor.rows,tableConstructor.dataAccessMethods);
  });
  // Exponer el builder para futuras referencias
  window.formioBuilder = formioBuilder;
});